<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<c:choose>
	<c:when test="${not empty param.json}" >
		<c:choose>
			<c:when test="${not empty param.type}" >
				<jsp:include page="/jsp/includes/viewerTemplate.jsp">
					<jsp:param name="title" value="${(param.type=='COMPOSITE')?'Your Composite View':'Registered Third Party Stack'}" />
					<jsp:param name="meta_root" value="/data/thirdparty/STACKS/3RDPARTY/" />
					<jsp:param name="json" value="${param.json}" />
					<jsp:param name="type" value="${param.type}" />
					<jsp:param name="tpbid" value="${param.tpbid}" />
					<jsp:param name="navpath" value="The VFB Site@/site/vfb_site/overview.htm|Stacks@#|Adult Brain Stack@/ " />	
					<jsp:param name="css" value="/css/tools/layer.css; /css/tools/layerProperties.css; /css/vfb/utils/resultList.css;" />	
				</jsp:include>
			</c:when>
			<c:otherwise>
				<jsp:include page="/jsp/includes/viewerTemplate.jsp">
					<jsp:param name="title" value="${(param.type=='COMPOSITE')?'Your Composite View':'Registered Third Party Stack'}" />
					<jsp:param name="meta_root" value="/data/thirdparty/STACKS/3RDPARTY/" />
					<jsp:param name="json" value="${param.json}" />
					<jsp:param name="tpbid" value="${param.tpbid}" />
					<jsp:param name="type" value="THIRD_PARTY_STACK" />
					<jsp:param name="navpath" value="The VFB Site@/site/vfb_site/overview.htm|Stacks@#|Adult Brain Stack@/ " />	
					<jsp:param name="css" value="/css/tools/layer.css; /css/tools/layerProperties.css; /css/vfb/utils/resultList.css;" />	
				</jsp:include>
			</c:otherwise>
		</c:choose>
	</c:when>
	<c:otherwise>
		<c:set var="idPassed" value="${param['tbpid']}" scope="request" />
		<c:set var="idNumeric" value="${fn:split(idPassed, '_')[1]}" scope="request" />
		<c:set var="idFirst" value="${fn:substring(idNumeric, 0, 4)}" scope="request" />
		<c:set var="idLast" value="${fn:substring(idNumeric, 4, 8)}" scope="request" />
		<c:choose>
			<c:when test="${not empty param.type}" >
				<jsp:include page="/jsp/includes/viewerTemplate.jsp">
					<jsp:param name="title" value="${(param.type=='COMPOSITE')?'Your Composite View':'Registered Third Party Stack'}" />
					<jsp:param name="meta_root" value="/data/thirdparty/STACKS/3RDPARTY/" />
					<jsp:param name="json" value="VFB/i/${idFirst}/${idLast}/data.jso" />
					<jsp:param name="type" value="${param.type}" />
					<jsp:param name="tpbid" value="${param.tpbid}" />
					<jsp:param name="navpath" value="The VFB Site@/site/vfb_site/overview.htm|Stacks@#|Adult Brain Stack@/ " />	
					<jsp:param name="css" value="/css/tools/layer.css; /css/tools/layerProperties.css; /css/vfb/utils/resultList.css;" />	
				</jsp:include>
			</c:when>
			<c:otherwise>
				<jsp:include page="/jsp/includes/viewerTemplate.jsp">
					<jsp:param name="title" value="${requestScope.idPassed}" />
					<jsp:param name="meta_root" value="/data/thirdparty/STACKS/3RDPARTY/" />
					<jsp:param name="json" value="VFB/i/${idFirst}/${idLast}/data.jso" />
					<jsp:param name="type" value="THIRD_PARTY_STACK" />
					<jsp:param name="tpbid" value="${param.tpbid}" />
					<jsp:param name="navpath" value="The VFB Site@/site/vfb_site/overview.htm|Stacks@#|Adult Brain Stack@/ " />	
					<jsp:param name="css" value="/css/tools/layer.css; /css/tools/layerProperties.css; /css/vfb/utils/resultList.css;" />	
				</jsp:include>
			</c:otherwise>
		</c:choose>	
	</c:otherwise>
</c:choose>
	
